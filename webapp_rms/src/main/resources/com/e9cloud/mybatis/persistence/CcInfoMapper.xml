<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="CcInfo_Mapper" >
  <resultMap id="BaseResultMap" type="com.e9cloud.mybatis.domain.CcInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="sid" property="sid" jdbcType="VARCHAR" />
    <result column="appid" property="appid" jdbcType="VARCHAR" />
    <result column="subid" property="subid" jdbcType="VARCHAR" />
    <result column="ccname" property="ccname" jdbcType="VARCHAR" />
    <result column="relay1" property="relay1" jdbcType="VARCHAR" />
    <result column="relay2" property="relay2" jdbcType="VARCHAR" />
    <result column="life_relay" property="lifeRelay" jdbcType="VARCHAR" />
    <result column="cco_max_num" property="ccoMaxNum" jdbcType="INTEGER" />
    <result column="dtmf_num" property="dtmfNum" jdbcType="VARCHAR" />
    <result column="default_cc" property="defaultCc" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="ctime" property="ctime" jdbcType="TIMESTAMP" />
    <result column="relay3" property="relay3" jdbcType="VARCHAR" />
    <result column="relay4" property="relay4" jdbcType="VARCHAR" />
    <result column="relay5" property="relay5" jdbcType="VARCHAR" />
    <result column="weight1" property="weight1" jdbcType="INTEGER" />
    <result column="weight2" property="weight2" jdbcType="INTEGER" />
    <result column="weight3" property="weight3" jdbcType="INTEGER" />
    <result column="weight4" property="weight4" jdbcType="INTEGER" />
    <result column="weight5" property="weight5" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List" >
    id, sid, appid, subid, ccname, relay1,relay2, life_relay,
    cco_max_num, dtmf_num, default_cc, status, remark, ctime, relay3, relay4, relay5, weight1, weight2,
    weight3, weight4, weight5
  </sql>

  <!-- 分页选取呼叫中心列表 -->
  <select id="pageCcInfoList" resultType="map" parameterType="Page">
    <include refid="com.e9cloud.pre"/>
    select
      tc.id,tc.ctime,tc.sid,tuc.name,ta.app_name,tc.appid,tc.ccname,
      tc.subid,tc.cco_max_num,tc.default_cc,tc.relay1,tc.status
    from tb_cc_info tc
    inner join tb_user_admin tu on tc.sid=tu.sid
    inner join tb_user_admin_authen_company tuc on tu.uid=tuc.uid
    inner join tb_app_info ta on tc.appid=ta.appid
    and tc.status='00'
    <if test="params.name != null and params.name != ''">
      and tuc.name LIKE "%"#{params.name,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.appName != null and params.appName != ''">
      and ta.app_name LIKE "%"#{params.appName,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.ccname != null and params.ccname != ''">
      and tc.ccname LIKE "%"#{params.ccname,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.subid != null and params.subid != ''">
      and tc.subid = #{params.subid,jdbcType=VARCHAR}
    </if>
    <if test="params.defaultCc != null and params.defaultCc != ''">
      and tc.default_cc = #{params.defaultCc,jdbcType=INTEGER}
    </if>
    <if test="timemin != null">
      and tc.ctime &gt;= #{timemin,jdbcType=TIMESTAMP}
    </if>
    <if test="timemax != null">
      and tc.ctime &lt;= #{timemax,jdbcType=TIMESTAMP}
    </if>

    <if test="sidx != null and sidx != ''">
      order by ${sidx} ${sord}
    </if>
    <include refid="com.e9cloud.suf"/>
  </select>

  <insert id="saveCcInfo" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_cc_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="sid != null" >
        sid,
      </if>
      <if test="appid != null" >
        appid,
      </if>
      <if test="subid != null" >
        subid,
      </if>
      <if test="ccname != null" >
        ccname,
      </if>
      <if test="relay1 != null" >
        relay1,
      </if>
      <if test="relay2 != null" >
        relay2,
      </if>
      <if test="lifeRelay != null" >
        life_relay,
      </if>
      <if test="ccoMaxNum != null" >
        cco_max_num,
      </if>
      <if test="dtmfNum != null" >
        dtmf_num,
      </if>
      <if test="defaultCc != null" >
        default_cc,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="ctime != null" >
        ctime,
      </if>
      <if test="relay3 != null" >
        relay3,
      </if>
      <if test="relay4 != null" >
        relay4,
      </if>
      <if test="relay5 != null" >
        relay5,
      </if>
      <if test="weight1 != null" >
        weight1,
      </if>
      <if test="weight2 != null" >
        weight2,
      </if>
      <if test="weight3 != null" >
        weight3,
      </if>
      <if test="weight4 != null" >
        weight4,
      </if>
      <if test="weight5 != null" >
        weight5,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="sid != null" >
        #{sid,jdbcType=VARCHAR},
      </if>
      <if test="appid != null" >
        #{appid,jdbcType=VARCHAR},
      </if>
      <if test="subid != null" >
        #{subid,jdbcType=VARCHAR},
      </if>
      <if test="ccname != null" >
        #{ccname,jdbcType=VARCHAR},
      </if>
      <if test="relay1 != null" >
        #{relay1,jdbcType=VARCHAR},
      </if>
      <if test="relay2 != null" >
        #{relay2,jdbcType=VARCHAR},
      </if>
      <if test="lifeRelay != null" >
        #{lifeRelay,jdbcType=VARCHAR},
      </if>
      <if test="ccoMaxNum != null" >
        #{ccoMaxNum,jdbcType=INTEGER},
      </if>
      <if test="dtmfNum != null" >
        #{dtmfNum,jdbcType=VARCHAR},
      </if>
      <if test="defaultCc != null" >
        #{defaultCc,jdbcType=BIT},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="ctime != null" >
        #{ctime,jdbcType=TIMESTAMP},
      </if>
      <if test="relay3 != null" >
        #{relay3,jdbcType=VARCHAR},
      </if>
      <if test="relay4 != null" >
        #{relay4,jdbcType=VARCHAR},
      </if>
      <if test="relay5 != null" >
        #{relay5,jdbcType=VARCHAR},
      </if>
      <if test="weight1 != null" >
        #{weight1,jdbcType=INTEGER},
      </if>
      <if test="weight2 != null" >
        #{weight2,jdbcType=INTEGER},
      </if>
      <if test="weight3 != null" >
        #{weight3,jdbcType=INTEGER},
      </if>
      <if test="weight4 != null" >
        #{weight4,jdbcType=INTEGER},
      </if>
      <if test="weight5 != null" >
        #{weight5,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>

  <update id="updateCcInfo" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_cc_info
    <set >
      <if test="sid != null" >
        sid = #{sid,jdbcType=VARCHAR},
      </if>
      <if test="appid != null" >
        appid = #{appid,jdbcType=VARCHAR},
      </if>
      <if test="subid != null" >
        subid = #{subid,jdbcType=VARCHAR},
      </if>
      <if test="ccname != null" >
        ccname = #{ccname,jdbcType=VARCHAR},
      </if>
      <if test="relay1 != null" >
        relay1 = #{relay1,jdbcType=VARCHAR},
      </if>
      <if test="relay2 != null" >
        relay2 = #{relay2,jdbcType=VARCHAR},
      </if>
      <if test="lifeRelay != null" >
        life_relay = #{lifeRelay,jdbcType=VARCHAR},
      </if>
      <if test="ccoMaxNum != null" >
        cco_max_num = #{ccoMaxNum,jdbcType=INTEGER},
      </if>
      <if test="dtmfNum != null" >
        dtmf_num = #{dtmfNum,jdbcType=VARCHAR},
      </if>
      <if test="defaultCc != null" >
        default_cc = #{defaultCc,jdbcType=BIT},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="relay3 != null" >
        relay3 = #{relay3,jdbcType=VARCHAR},
      </if>
      <if test="relay4 != null" >
        relay4 = #{relay4,jdbcType=VARCHAR},
      </if>
      <if test="relay5 != null" >
        relay5 = #{relay5,jdbcType=VARCHAR},
      </if>
      <if test="weight1 != null" >
        weight1 = #{weight1,jdbcType=INTEGER},
      </if>
      <if test="weight2 != null" >
        weight2 = #{weight2,jdbcType=INTEGER},
      </if>
      <if test="weight3 != null" >
        weight3 = #{weight3,jdbcType=INTEGER},
      </if>
      <if test="weight4 != null" >
        weight4 = #{weight4,jdbcType=INTEGER},
      </if>
      <if test="weight5 != null" >
        weight5 = #{weight5,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>

  <delete id="delCcInfo" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    delete from tb_cc_info
    where id = #{id,jdbcType=INTEGER}
  </delete>

  <!-- 更改呼叫中心的状态 -->
  <update id="updateCcInfoStatus" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    UPDATE tb_cc_info
    SET status = #{status,jdbcType=VARCHAR},
        relay1 = '',
        relay2 = '',
        relay3 = '',
        relay4 = '',
        relay5 = '',
        weight1 = 1,
        weight2 = 1,
        weight3 = 1,
        weight4 = 1,
        weight5 = 1
    where subid = #{subid,jdbcType=VARCHAR}
  </update>

  <!-- 更改呼叫中心的默认 -->
  <update id="updateCcInfodefaultCc" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    UPDATE tb_cc_info
    SET default_cc = 0
    where appid = #{appid,jdbcType=VARCHAR}
    and subid != #{subid,jdbcType=VARCHAR}
  </update>

  <resultMap id="nameResultMap" type="com.e9cloud.mybatis.domain.CcInfo" extends="BaseResultMap">
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="app_name" property="appName" jdbcType="VARCHAR" />
    <result column="relay_name1" property="relayName1" jdbcType="VARCHAR" />
    <result column="relay_name2" property="relayName2" jdbcType="VARCHAR" />
    <result column="relay_name3" property="relayName3" jdbcType="VARCHAR" />
    <result column="relay_name4" property="relayName4" jdbcType="VARCHAR" />
    <result column="relay_name5" property="relayName5" jdbcType="VARCHAR" />
  </resultMap>

  <select id="queryCcInfoById" resultMap="nameResultMap" parameterType="java.lang.String" >
    select
      tc.*,tuc.name,ta.app_name,tb1.relay_name as  relay_name1,tb2.relay_name as relay_name2,tb3.relay_name as relay_name3,tb4.relay_name as relay_name4,tb5.relay_name as relay_name5
    from tb_cc_info tc
    inner join tb_user_admin tu on tc.sid=tu.sid
    inner join tb_user_admin_authen_company tuc on tu.uid=tuc.uid
    inner join tb_app_info ta on tc.appid=ta.appid
    left join tb_sip_basic tb1 on tc.relay1=tb1.relay_num
    left join tb_sip_basic tb2 on tc.relay2=tb2.relay_num
    left join tb_sip_basic tb3 on tc.relay3=tb3.relay_num
    left join tb_sip_basic tb4 on tc.relay4=tb4.relay_num
    left join tb_sip_basic tb5 on tc.relay5=tb5.relay_num
    where tc.id = #{id,jdbcType=INTEGER}
  </select>

  <select id="countCcInfo" resultType="Integer" parameterType="com.e9cloud.mybatis.domain.CcInfo" >
    select count(1)
    from tb_cc_info
    where 1=1
    and status='00'
    <if test="appid!=null and appid!=''">
      and appid = #{appid,jdbcType=VARCHAR}
    </if>
    <if test="ccname!=null and ccname!=''">
      and ccname = #{ccname,jdbcType=VARCHAR}
    </if>
    <if test="id!=null and id!=''">
      and id != #{id,jdbcType=INTEGER}
    </if>
    <if test="subid!=null and subid!=''">
      and subid = #{subid,jdbcType=VARCHAR}
    </if>
  </select>

  <select id="queryCcInfoBySid" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from tb_cc_info
    where status = '00'
    and sid = #{sid,jdbcType=VARCHAR}
  </select>

</mapper>
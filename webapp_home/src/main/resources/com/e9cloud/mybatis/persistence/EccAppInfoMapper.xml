<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="EccAppInfo_Mapper" >
  <resultMap id="BaseResultMap" type="com.e9cloud.mybatis.domain.EccAppInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="appid" property="appid" jdbcType="VARCHAR" />
    <result column="switchboard_id" property="switchboardId" jdbcType="VARCHAR" />
    <result column="cityid" property="cityid" jdbcType="VARCHAR" />
    <result column="transfer" property="transfer" jdbcType="BIT" />
    <result column="transfer_num" property="transferNum" jdbcType="VARCHAR" />
    <result column="ivr_voice_need" property="ivrVoiceNeed" jdbcType="BIT" />
    <result column="ivr_voice_name" property="ivrVoiceName" jdbcType="VARCHAR" />
    <result column="ivr_voice_url" property="ivrVoiceUrl" jdbcType="VARCHAR" />
    <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
    <result column="updatetime" property="updatetime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, appid, switchboard_id, cityid, transfer, transfer_num, ivr_voice_need, ivr_voice_name,
    ivr_voice_url, addtime, updatetime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from tb_app_info_ecc
    where id = #{id,jdbcType=VARCHAR}
  </select>

  <select id="findAppEccByAppId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select
    <include refid="Base_Column_List" />
    from tb_app_info_ecc
    where appid = #{appid,jdbcType=VARCHAR}
  </select>

  <select id="findCityEccByAppId" resultType="map" parameterType="java.lang.String" >
    select a.number ,c.cname,p.pname from tb_ecc_switchboard a left join tb_telno_city c on a.cityid = c.ccode
    left join tb_telno_province p on c.pcode = p.pcode
    where appid = #{appid,jdbcType=VARCHAR}
  </select>


  <select id="downloadpageEccApp" resultType="map" parameterType="Page" >

    select  id, appid, sid, app_name,  b.name as app_type ,status, create_date,quota,limit_flag
    from
    tb_app_info a left join (select name,code from tb_dic_data where typekey = 'appType') b on  a.app_type = b.code
    where a.sid =  #{params.sid,jdbcType=VARCHAR}

    <if test="params.appName != null and params.appName != ''">
      and a.app_name like  CONCAT('%',#{params.appName,jdbcType=VARCHAR},'%')
    </if>

    <if test="params.appType != null and params.appType != ''">
      and a.app_type = #{params.appType,jdbcType=VARCHAR}
    </if>

    <if test="params.busType != null and params.busType != ''">
      and a.bus_type = #{params.busType,jdbcType=VARCHAR}
    </if>
    order by status,create_date  desc

  </select>




  <select id="pageEccNum" resultType="map" parameterType="Page" >
    <include refid="com.e9cloud.pre"/>
    SELECT
    ee.id, ee.appid,ee.sub_num subNum, ee.num_type numType,cp.pname,cp.cname,
    ee.long_distance_flag longDistanceFlag, ee.call_switch_flag callSwitchFlag, ee.`status`, ee.addtime, ee.updatetime,
    es.sip_phone sipphone, ef.number fixphone, eh.number shownum
    FROM tb_ecc_extention ee
    LEFT JOIN tb_ecc_sipphone es ON ee.sipphone_id = es.id
    LEFT JOIN tb_ecc_fixphone ef ON ee.fixphone_id = ef.id
    LEFT JOIN tb_ecc_shownum  eh ON ee.shownum_id = eh.id

    LEFT JOIN (
    SELECT
    tc.cname, tp.pname, tc.ccode, tp.pcode
    FROM tb_telno_city tc LEFT JOIN tb_telno_province tp ON tc.pcode = tp.pcode
    ) cp ON ef.cityid = cp.ccode
    WHERE  1=1

    <if test="params.appid != null and params.appid != ''">
      and ee.appid = #{params.appid,jdbcType=VARCHAR}
    </if>

    <if test="params.numType != null and params.numType != ''">
      and ee.num_type = #{params.numType,jdbcType=VARCHAR}
    </if>
    <if test="params.subNum != null and params.subNum != ''">
      and ee.sub_num LIKE "%"#{params.subNum,jdbcType=VARCHAR}"%"
    </if>

    <if test="params.sipphone != null and params.sipphone != ''">
      and es.sip_phone LIKE "%"#{params.sipphone,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.fixphone != null and params.fixphone != ''">
      and ef.number LIKE "%"#{params.fixphone,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.shownum != null and params.shownum != ''">
      and eh.number LIKE "%"#{params.shownum,jdbcType=VARCHAR}"%"
    </if>
    <if test="params.ccode != null and params.ccode != ''">
      and ef.cityid = #{params.ccode,jdbcType=VARCHAR}
    </if>
    <!--<if test="params.pcode != null and params.pcode != ''">-->
      <!--and tp.pcode = #{params.pcode,jdbcType=VARCHAR}-->
    <!--</if>-->

    <if test="params.callSwitchFlag != null and params.callSwitchFlag != ''">
      and ee.call_switch_flag = #{params.callSwitchFlag,jdbcType=VARCHAR}
    </if>
    <if test="params.longDistanceFlag != null and params.longDistanceFlag != ''">
      and ee.long_distance_flag = #{params.longDistanceFlag,jdbcType=VARCHAR}
    </if>


    ORDER BY ee.addtime DESC

    <include refid="com.e9cloud.suf"/>
  </select>




  <delete id="deleteByPrimaryKey" parameterType="java.lang.String" >
    delete from tb_app_info_ecc
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.e9cloud.mybatis.domain.EccAppInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_app_info_ecc (id, appid, switchboard_id, 
      cityid, transfer, transfer_num, 
      ivr_voice_need, ivr_voice_name, ivr_voice_url, 
      addtime, updatetime)
    values (#{id,jdbcType=VARCHAR}, #{appid,jdbcType=VARCHAR}, #{switchboardId,jdbcType=VARCHAR}, 
      #{cityid,jdbcType=VARCHAR}, #{transfer,jdbcType=BIT}, #{transferNum,jdbcType=VARCHAR}, 
      #{ivrVoiceNeed,jdbcType=BIT}, #{ivrVoiceName,jdbcType=VARCHAR}, #{ivrVoiceUrl,jdbcType=VARCHAR}, 
      #{addtime,jdbcType=TIMESTAMP}, #{updatetime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.e9cloud.mybatis.domain.EccAppInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into tb_app_info_ecc
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="appid != null" >
        appid,
      </if>
      <if test="switchboardId != null" >
        switchboard_id,
      </if>
      <if test="cityid != null" >
        cityid,
      </if>
      <if test="transfer != null" >
        transfer,
      </if>
      <if test="transferNum != null" >
        transfer_num,
      </if>
      <if test="ivrVoiceNeed != null" >
        ivr_voice_need,
      </if>
      <if test="ivrVoiceName != null" >
        ivr_voice_name,
      </if>
      <if test="ivrVoiceUrl != null" >
        ivr_voice_url,
      </if>
      <if test="addtime != null" >
        addtime,
      </if>
      <if test="updatetime != null" >
        updatetime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="appid != null" >
        #{appid,jdbcType=VARCHAR},
      </if>
      <if test="switchboardId != null" >
        #{switchboardId,jdbcType=VARCHAR},
      </if>
      <if test="cityid != null" >
        #{cityid,jdbcType=VARCHAR},
      </if>
      <if test="transfer != null" >
        #{transfer,jdbcType=BIT},
      </if>
      <if test="transferNum != null" >
        #{transferNum,jdbcType=VARCHAR},
      </if>
      <if test="ivrVoiceNeed != null" >
        #{ivrVoiceNeed,jdbcType=BIT},
      </if>
      <if test="ivrVoiceName != null" >
        #{ivrVoiceName,jdbcType=VARCHAR},
      </if>
      <if test="ivrVoiceUrl != null" >
        #{ivrVoiceUrl,jdbcType=VARCHAR},
      </if>
      <if test="addtime != null" >
        #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        #{updatetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.e9cloud.mybatis.domain.EccAppInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_app_info_ecc
    <set >
      <if test="appid != null" >
        appid = #{appid,jdbcType=VARCHAR},
      </if>
      <if test="switchboardId != null" >
        switchboard_id = #{switchboardId,jdbcType=VARCHAR},
      </if>
      <if test="cityid != null" >
        cityid = #{cityid,jdbcType=VARCHAR},
      </if>
      <if test="transfer != null" >
        transfer = #{transfer,jdbcType=BIT},
      </if>
      <if test="transferNum != null" >
        transfer_num = #{transferNum,jdbcType=VARCHAR},
      </if>
      <if test="ivrVoiceNeed != null" >
        ivr_voice_need = #{ivrVoiceNeed,jdbcType=BIT},
      </if>
      <if test="ivrVoiceName != null" >
        ivr_voice_name = #{ivrVoiceName,jdbcType=VARCHAR},
      </if>
      <if test="ivrVoiceUrl != null" >
        ivr_voice_url = #{ivrVoiceUrl,jdbcType=VARCHAR},
      </if>
      <if test="addtime != null" >
        addtime = #{addtime,jdbcType=TIMESTAMP},
      </if>
      <if test="updatetime != null" >
        updatetime = #{updatetime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.e9cloud.mybatis.domain.EccAppInfo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update tb_app_info_ecc
    set appid = #{appid,jdbcType=VARCHAR},
      switchboard_id = #{switchboardId,jdbcType=VARCHAR},
      cityid = #{cityid,jdbcType=VARCHAR},
      transfer = #{transfer,jdbcType=BIT},
      transfer_num = #{transferNum,jdbcType=VARCHAR},
      ivr_voice_need = #{ivrVoiceNeed,jdbcType=BIT},
      ivr_voice_name = #{ivrVoiceName,jdbcType=VARCHAR},
      ivr_voice_url = #{ivrVoiceUrl,jdbcType=VARCHAR},
      addtime = #{addtime,jdbcType=TIMESTAMP},
      updatetime = #{updatetime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=VARCHAR}
  </update>
</mapper>